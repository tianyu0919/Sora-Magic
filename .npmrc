# ========================================================================
# 包管理器配置文件 (.npmrc)
# 此文件控制pnpm/npm的行为和依赖解析策略
# ========================================================================

# 官方npm注册表 (已注释)
# registry=https://registry.npmjs.org/

# 使用国内npm镜像源加速依赖下载
registry=https://registry.npmmirror.com/

# Electron镜像源配置，加速Electron下载
# 使用国内镜像可以显著提高下载速度，避免网络问题
# 当安装或更新electron时，会从这个镜像源下载
# 适用于构建过程中的electron-builder依赖
# 适用于开发环境中的electron和electronmon依赖
electron_mirror=https://npmmirror.com/mirrors/electron/

# ========================================================================
# PNPM特定配置 - 解决Electron构建兼容性问题
# ========================================================================

# 依赖解析策略配置
# 设置为hoisted模式时，pnpm会使用类似npm/yarn的扁平依赖结构
# 这解决了electron-builder无法正确处理pnpm默认平铺结构的问题
# 关键原因：electron-builder打包时无法正确处理嵌套的node_modules结构
node-linker=hoisted

# 禁用符号链接
# pnpm默认使用符号链接管理依赖，这是其高效的关键特性
# 但在electron构建环境中，符号链接会导致：
# 1. electron-builder无法正确跟随符号链接
# 2. 打包后的应用找不到依赖模块（如conf、electron-store等）
# 3. 运行时出现"Cannot find module"错误
symlink=false

# 强制依赖提升
# 将所有依赖（包括深层嵌套依赖）提升到node_modules根目录
# 确保electron-builder能找到所有依赖，无论其嵌套深度如何
# 对于包含native模块或特殊文件操作的依赖尤其重要
# 这是与electron-store和better-sqlite3等模块兼容的关键设置
shamefully-hoist=true

# ========================================================================
# 注意事项
# ========================================================================
# 1. 此配置确保npm和pnpm都能成功构建项目
# 2. 当添加新的native模块依赖时，可能需要重新安装依赖
# 3. CI/CD环境中应保持相同的.npmrc配置以确保构建一致性
# 4. 避免修改此文件，除非完全理解配置项的影响
# ========================================================================